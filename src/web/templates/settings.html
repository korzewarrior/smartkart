{% extends "base.html" %}

{% block title %}SmartKart - Settings{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">Settings</div>
    
    <p>Audio settings (like voice, rate, volume) are currently managed by the PicoTTS engine and are not adjustable via this interface.</p>
    
    <!-- Remove pyttsx3-specific settings form -->
    <!-- 
    <form id="settings-form">
        <div class="form-group">
            <label class="form-label" for="speech-volume">Speech Volume</label>
            ...
        </div>
        
        <div class="form-group">
            <label class="form-label" for="speech-rate">Speech Rate</label>
            ...
        </div>
        
        {% if voices %}
        <div class="form-group">
            <label class="form-label" for="voice">Voice</label>
            ...
        </div>
        {% endif %}
        
        <div class="form-group" style="margin-top: 30px;">
            <button type="submit" class="btn btn-success">Save Settings</button>
            <button type="button" id="reset-settings" class="btn btn-danger">Reset to Defaults</button>
        </div>
    </form>
    -->

    <!-- Optionally keep Reset Database functionality if desired -->
    <div class="card" style="margin-top: 30px;">
        <div class="card-header">Database Management</div>
        <div style="padding: 20px;">
            <p>Resetting the database will clear the list of scanned products and related files.</p>
            <button id="reset-db-btn" class="btn btn-danger">Reset Product Database</button>
        </div>
    </div>

</div>

<!-- Success Alert -->
<div id="success-alert" class="alert alert-success" style="display: none; margin-top: 20px;">
    Settings action completed.
</div>

<!-- Reset Confirmation Modals -->
<!-- Settings Reset Modal (Keep or remove based on whether any settings remain) -->
<!-- 
<div id="reset-modal" style="display: none; ...">
    ...
</div> 
-->

<!-- Database Reset Modal -->
<div id="reset-db-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 100; justify-content: center; align-items: center;">
    <div class="card" style="max-width: 400px; width: 90%;">
        <div class="card-header">Confirm Database Reset</div>
        <div style="padding: 20px;">
            <p>Are you sure you want to reset the product database? This cannot be undone.</p>
        </div>
        <div style="padding: 15px; display: flex; justify-content: flex-end; gap: 10px; border-top: 2px solid var(--dark);">
            <button id="cancel-reset-db-btn" class="btn btn-secondary">Cancel</button>
            <button id="confirm-reset-db-btn" class="btn btn-danger">Reset Database</button>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Remove refs to volume/rate/voice elements
        const successAlert = document.getElementById('success-alert');
        
        // Database Reset Elements
        const resetDbBtn = document.getElementById('reset-db-btn');
        const resetDbModal = document.getElementById('reset-db-modal');
        const cancelResetDbBtn = document.getElementById('cancel-reset-db-btn');
        const confirmResetDbBtn = document.getElementById('confirm-reset-db-btn');
        
        // Remove pyttsx3 test/save logic
        
        // --- Database Reset Logic (Keep if needed) --- 
        if (resetDbBtn) {
            resetDbBtn.addEventListener('click', function() {
                resetDbModal.style.display = 'flex';
            });
        }
        
        if (cancelResetDbBtn) {
            cancelResetDbBtn.addEventListener('click', function() {
                resetDbModal.style.display = 'none';
            });
        }

        if (resetDbModal) {
            resetDbModal.addEventListener('click', function(event) {
                if (event.target === resetDbModal) {
                    resetDbModal.style.display = 'none';
                }
            });
        }
        
        if (confirmResetDbBtn) {
            confirmResetDbBtn.addEventListener('click', function() {
                // Send reset request to server
                fetch('/api/reset_database', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        successAlert.textContent = 'Product database has been reset.';
                        successAlert.style.display = 'block';
                        setTimeout(() => {
                            successAlert.style.display = 'none';
                        }, 3000);
                    } else {
                        alert('Error resetting database. Please try again.');
                    }
                })
                .catch(error => {
                    console.error('Error resetting database:', error);
                    alert('Error resetting database. Please try again.');
                })
                .finally(() => {
                    resetDbModal.style.display = 'none';
                });
            });
        }
    });
</script>
{% endblock %} 